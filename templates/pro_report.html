<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>{{ ticker }} – Professional Report</title>
  {% if css_href %}
    <link rel="stylesheet" href="{{ css_href }}">
  {% elif css_inline %}
    <style>{{ css_inline }}</style>
  {% endif %}
</head>
<body>
<div class="container">

  {% macro money(v) -%}
    {%- if v is not none -%}${{ "{:,.0f}".format(v) }}{%- else -%}—{%- endif -%}
  {%- endmacro %}

  {% macro money2(v) -%}
    {%- if v is not none -%}${{ "{:,.2f}".format(v) }}{%- else -%}—{%- endif -%}
  {%- endmacro %}

  {% macro mult(v) -%}
    {%- if v is not none -%}{{ "{:.2f}".format(v) }}x{%- else -%}—{%- endif -%}
  {%- endmacro %}

  {% macro pct(v, d=1) -%}
    {%- if v is not none -%}{{ "{:.{}f}%".format(v, d) }}{%- else -%}—{%- endif -%}
  {%- endmacro %}

  {% macro yoy(cur, prev) -%}
    {%- if cur is not none and prev is not none and prev != 0 -%}
      {{ "{:+.1f}%".format((cur - prev) / prev * 100.0) }}
    {%- else -%}—
    {%- endif -%}
  {%- endmacro %}

  <header class="page-header">
    <div>
      <h1>{{ ticker }}</h1>
      <div class="muted">Professional Report · As of {{ as_of }}</div>
      <div class="tags">
        <span class="pill">Sector: {{ profile.sector or "N/A" }}</span>
        <span class="pill">Industry: {{ profile.industry or "N/A" }}</span>
      </div>
    </div>
  </header>

  <!-- Company description -->
  <section class="section">
    <h2>Company Overview</h2>
    <div class="card">
      {% if profile.description %}
        <p class="lead">{{ profile.description }}</p>
      {% else %}
        <p class="muted">No description available.</p>
      {% endif %}
    </div>
  </section>

  <!-- Snapshot cards -->
  <section class="section">
    <h2>Snapshot</h2>
    <div class="grid grid-3">
      {% for row in header_table %}
        <div class="card kpi">
          <div class="kpi-key">{{ row.label }}</div>
          <div class="kpi-val">
            {% if row.label in ["Share Price","52-day Avg"] %}
              {{ money2(row.value) }}
            {% elif row.label in ["EV/S (TTM)","EV/EBITDA (TTM)"] %}
              {{ mult(row.value) }}
            {% else %}
              {{ money(row.value) }}
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>
  </section>

  <!-- Last 2-year financials + estimates -->
  <section class="section">
    <h2>Financials — Last 2 Fiscal Years</h2>
    <div class="card">
      <table class="table">
        <thead>
          <tr>
            <th>Metric</th>
            {% set years = [] %}
            {% for r in two_year %}
              {% for k,v in r.items() if k != "metric" %}
                {% if k not in years %}{% set _ = years.append(k) %}{% endif %}
              {% endfor %}
            {% endfor %}
            {% for y in years %}<th class="tr">{{ y }}</th>{% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for r in two_year %}
          <tr>
            <td>{{ r.metric }}</td>
            {% for y in years %}
              {% set val = r.get(y) %}
              <td class="tr">{{ money(val) }}</td>
            {% endfor %}
          </tr>
          {% endfor %}
          {% if estimates and (estimates.revenue_est or estimates.ebitda_est) %}
          <tr class="subtle">
            <td><em>Analyst Est. Revenue</em></td>
            <td class="tr" colspan="{{ years|length }}">{{ money(estimates.revenue_est) }}</td>
          </tr>
          <tr class="subtle">
            <td><em>Analyst Est. EBITDA</em></td>
            <td class="tr" colspan="{{ years|length }}">{{ money(estimates.ebitda_est) }}</td>
          </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </section>

  <!-- Financial snapshot: last quarter + YTD with YoY -->
  <section class="section">
    <h2>Financial Snapshot</h2>
    <div class="cols">
      <div class="card">
        <h3>Last Quarter ({{ fin_snapshot.quarter.period or "N/A" }})</h3>
        <table class="table tight">
          <tbody>
            <tr><td>Revenue</td><td class="tr">{{ money(fin_snapshot.quarter.revenue) }}</td><td class="yoy">{{ yoy(fin_snapshot.quarter.revenue, fin_snapshot.quarter.yoy.revenue) }}</td></tr>
            <tr><td>Gross Margin</td><td class="tr">{{ pct(fin_snapshot.quarter.gross_margin_pct,1) }}</td><td class="yoy muted">YoY</td></tr>
            <tr><td>EBITDA</td><td class="tr">{{ money(fin_snapshot.quarter.ebitda) }}</td><td class="yoy">{{ yoy(fin_snapshot.quarter.ebitda, fin_snapshot.quarter.yoy.ebitda) }}</td></tr>
            <tr><td>Net Income</td><td class="tr">{{ money(fin_snapshot.quarter.net_income) }}</td><td class="yoy">{{ yoy(fin_snapshot.quarter.net_income, fin_snapshot.quarter.yoy.net_income) }}</td></tr>
            <tr><td>Cash Flow from Ops</td><td class="tr">{{ money(fin_snapshot.quarter.ocf) }}</td><td class="yoy">{{ yoy(fin_snapshot.quarter.ocf, fin_snapshot.quarter.yoy.ocf) }}</td></tr>
            <tr><td>Free Cash Flow</td><td class="tr">{{ money(fin_snapshot.quarter.fcf) }}</td><td class="yoy">{{ yoy(fin_snapshot.quarter.fcf, fin_snapshot.quarter.yoy.fcf) }}</td></tr>
          </tbody>
        </table>
      </div>

      <div class="card">
        <h3>Year-to-Date ({{ fin_snapshot.ytd.year }})</h3>
        <table class="table tight">
          <tbody>
            <tr><td>Revenue</td><td class="tr">{{ money(fin_snapshot.ytd.revenue) }}</td></tr>
            <tr><td>EBITDA</td><td class="tr">{{ money(fin_snapshot.ytd.ebitda) }}</td></tr>
            <tr><td>Net Income</td><td class="tr">{{ money(fin_snapshot.ytd.net_income) }}</td></tr>
            <tr><td>Cash Flow from Ops</td><td class="tr">{{ money(fin_snapshot.ytd.ocf) }}</td></tr>
            <tr><td>Free Cash Flow</td><td class="tr">{{ money(fin_snapshot.ytd.fcf) }}</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    {% if commentary.financials %}
      <div class="card note">
        <h3>LLM Commentary — Financials</h3>
        <div class="md">{{ commentary.financials | safe }}</div>
      </div>
    {% endif %}
  </section>

  <!-- Industry & Macro -->
  <section class="section">
    <h2>Industry & Macro</h2>
    <div class="card">
      <h3>Industry Snapshot & Competitive Positioning</h3>
      {% if commentary.industry %}
        <div class="md">{{ commentary.industry | safe }}</div>
      {% else %}
        <p class="muted">No LLM commentary available.</p>
      {% endif %}
    </div>

    <div class="card" style="margin-top:12px">
      <h3>Sector Momentum & Technicals</h3>
      <div class="tagrow">
        <span class="pill">ETF: {{ sector_inputs.chosen_sector_etf or "N/A" }}</span>
        <span class="pill">RSI(14): {{ "{:.1f}".format(technical.rsi_14) if technical.rsi_14 is not none else "N/A" }}</span>
      </div>
      {% if commentary.sector %}
        <div class="md">{{ commentary.sector | safe }}</div>
      {% else %}
        <p class="muted">No LLM commentary available.</p>
      {% endif %}
    </div>
  </section>

  <!-- Peer group -->
  <section class="section">
    <h2>Peer Group (≤ 6)</h2>
    <div class="card">
      <table class="table">
        <thead>
          <tr>
            <th>Ticker</th>
            <th class="tr">EV/S (TTM)</th>
            <th class="tr">EV/EBITDA (TTM)</th>
            <th class="tr">Dividend Yield</th>
            <th class="tr">FCF Yield</th>
          </tr>
        </thead>
        <tbody>
          {% for r in peer_rows %}
          <tr>
            <td>{{ r["Ticker"] }}</td>
            <td class="tr">{{ r["EV/S (TTM)"] is not none and "{:.2f}x".format(r["EV/S (TTM)"]) or "—" }}</td>
            <td class="tr">{{ r["EV/EBITDA (TTM)"] is not none and "{:.2f}x".format(r["EV/EBITDA (TTM)"]) or "—" }}</td>
            <td class="tr">{{ r["Dividend Yield %"] is not none and "{:.2f}%".format(r["Dividend Yield %"]) or "—" }}</td>
            <td class="tr">{{ r["FCF Yield %"] is not none and "{:.2f}%".format(r["FCF Yield %"]) or "—" }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      <div class="muted footnote">
        Subject 5-yr avgs — EV/S: {{ peer_five_year["EV/S 5y Avg"] is not none and "{:.2f}x".format(peer_five_year["EV/S 5y Avg"]) or "—" }},
        EV/EBITDA: {{ peer_five_year["EV/EBITDA 5y Avg"] is not none and "{:.2f}x".format(peer_five_year["EV/EBITDA 5y Avg"]) or "—" }}.
      </div>
    </div>
  </section>

  <footer class="muted small section">
    Data source: Financial Modeling Prep (FMP). Generated {{ as_of }}.
  </footer>

</div>
</body>
</html>
