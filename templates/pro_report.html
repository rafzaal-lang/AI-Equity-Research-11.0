<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>{{ ticker }} – Pro Report</title>
  <link rel="stylesheet" href="{{ static_path }}">
</head>
<body>
<div class="container">
  <header>
    <h1>{{ ticker }} – Professional Report</h1>
    <div class="muted">As of {{ as_of }}</div>
  </header>

  <section class="section">
    <h2>Company Overview</h2>
    <div class="card">
      {% if profile.description %}
        <p>{{ profile.description }}</p>
      {% else %}
        <p class="muted">No description available.</p>
      {% endif %}
      <div class="muted" style="margin-top:6px">
        <span class="pill">Sector: {{ profile.sector or "N/A" }}</span>
        <span class="pill">Industry: {{ profile.industry or "N/A" }}</span>
      </div>
    </div>
  </section>

  <section class="section">
    <h2>Snapshot</h2>
    <div class="grid">
      {% for row in header_table %}
      <div class="card">
        <div class="k">{{ row.label }}</div>
        <div class="v">
          {% if row.value is not none %}
            {% if row.label in ["Market Cap","Debt","Cash","Enterprise Value (EV)"] %}
              {{ "${:,.0f}".format(row.value) }}
            {% elif row.label in ["EV/S (TTM)","EV/EBITDA (TTM)"] %}
              {{ "{:.2f}".format(row.value) }}
            {% else %}
              {{ "{:,.2f}".format(row.value) }}
            {% endif %}
          {% else %} — {% endif %}
        </div>
      </div>
      {% endfor %}
    </div>
  </section>

  <section class="section">
    <h2>Financials – Last 2 Fiscal Years</h2>
    <div class="card">
      <table>
        <thead>
          <tr>
            <th>Metric</th>
            {% set years = [] %}
            {% for r in two_year %}
              {% for k,v in r.items() if k != "metric" %}
                {% if k not in years %}{% set _ = years.append(k) %}{% endif %}
              {% endfor %}
            {% endfor %}
            {% for y in years %}<th>{{ y }}</th>{% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for r in two_year %}
          <tr>
            <td>{{ r.metric }}</td>
            {% for y in years %}
            <td>
              {% set val = r.get(y) %}
              {% if val is not none %}
                {{ "${:,.0f}".format(val) }}
              {% else %} — {% endif %}
            </td>
            {% endfor %}
          </tr>
          {% endfor %}
          {% if estimates and (estimates.revenue_est or estimates.ebitda_est) %}
          <tr>
            <td><em>Analyst Est. Revenue</em></td>
            <td colspan="{{ years|length }}" style="text-align:right">
              {{ "${:,.0f}".format(estimates.revenue_est) if estimates.revenue_est else "—" }}
            </td>
          </tr>
          <tr>
            <td><em>Analyst Est. EBITDA</em></td>
            <td colspan="{{ years|length }}" style="text-align:right">
              {{ "${:,.0f}".format(estimates.ebitda_est) if estimates.ebitda_est else "—" }}
            </td>
          </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </section>

  <section class="section">
    <h2>Financial Snapshot</h2>
    <div class="cols">
      <div class="card">
        <h3 style="margin-top:0">Last Quarter ({{ fin_snapshot.quarter.period or "N/A" }})</h3>
        <table>
          <tbody>
          <tr><td>Revenue</td><td>{{ "${:,.0f}".format(fin_snapshot.quarter.revenue) if fin_snapshot.quarter.revenue is not none else "—" }}</td></tr>
          <tr><td>Gross Margin %</td><td>{{ "{:.1f}%".format(fin_snapshot.quarter.gross_margin_pct) if fin_snapshot.quarter.gross_margin_pct is not none else "—" }}</td></tr>
          <tr><td>EBITDA</td><td>{{ "${:,.0f}".format(fin_snapshot.quarter.ebitda) if fin_snapshot.quarter.ebitda is not none else "—" }}</td></tr>
          <tr><td>Net Income</td><td>{{ "${:,.0f}".format(fin_snapshot.quarter.net_income) if fin_snapshot.quarter.net_income is not none else "—" }}</td></tr>
          <tr><td>Operating Cash Flow</td><td>{{ "${:,.0f}".format(fin_snapshot.quarter.ocf) if fin_snapshot.quarter.ocf is not none else "—" }}</td></tr>
          <tr><td>Free Cash Flow</td><td>{{ "${:,.0f}".format(fin_snapshot.quarter.fcf) if fin_snapshot.quarter.fcf is not none else "—" }}</td></tr>
          </tbody>
        </table>
        <div class="muted" style="margin-top:8px">YoY comps shown if available.</div>
      </div>
      <div class="card">
        <h3 style="margin-top:0">Year-to-Date ({{ fin_snapshot.ytd.year }})</h3>
        <table>
          <tbody>
          <tr><td>Revenue</td><td>{{ "${:,.0f}".format(fin_snapshot.ytd.revenue) if fin_snapshot.ytd.revenue is not none else "—" }}</td></tr>
          <tr><td>EBITDA</td><td>{{ "${:,.0f}".format(fin_snapshot.ytd.ebitda) if fin_snapshot.ytd.ebitda is not none else "—" }}</td></tr>
          <tr><td>Net Income</td><td>{{ "${:,.0f}".format(fin_snapshot.ytd.net_income) if fin_snapshot.ytd.net_income is not none else "—" }}</td></tr>
          <tr><td>Operating Cash Flow</td><td>{{ "${:,.0f}".format(fin_snapshot.ytd.ocf) if fin_snapshot.ytd.ocf is not none else "—" }}</td></tr>
          <tr><td>Free Cash Flow</td><td>{{ "${:,.0f}".format(fin_snapshot.ytd.fcf) if fin_snapshot.ytd.fcf is not none else "—" }}</td></tr>
          </tbody>
        </table>
      </div>
    </div>
    {% if commentary.financials %}
    <div class="card" style="margin-top:12px">
      <h3 style="margin-top:0">LLM Commentary – Financials</h3>
      <div>{{ commentary.financials | safe }}</div>
    </div>
    {% endif %}
  </section>

  <section class="section">
    <h2>Industry & Macro</h2>
    <div class="card">
      <h3 style="margin-top:0">Industry Snapshot & Competitive Positioning</h3>
      {% if commentary.industry %}
        <div>{{ commentary.industry | safe }}</div>
      {% else %}
        <p class="muted">No LLM commentary available.</p>
      {% endif %}
    </div>
    <div class="card" style="margin-top:12px">
      <h3 style="margin-top:0">Sector Momentum & Technicals</h3>
      <p class="muted">
        Sector ETF: {{ sector_inputs.chosen_sector_etf or "N/A" }} • RSI(14): {{ "{:.1f}".format(technical.rsi_14) if technical.rsi_14 is not none else "N/A" }}
      </p>
      {% if commentary.sector %}
        <div>{{ commentary.sector | safe }}</div>
      {% else %}
        <p class="muted">No LLM commentary available.</p>
      {% endif %}
    </div>
  </section>

  <section class="section">
    <h2>Peer Group (≤ 6)</h2>
    <div class="card">
      <table>
        <thead>
        <tr>
          <th>Ticker</th>
          <th>EV/S (TTM)</th>
          <th>EV/EBITDA (TTM)</th>
          <th>Dividend Yield %</th>
          <th>FCF Yield %</th>
        </tr>
        </thead>
        <tbody>
        {% for r in peer_rows %}
          <tr>
            <td>{{ r["Ticker"] }}</td>
            <td>{{ "{:.2f}".format(r["EV/S (TTM)"]) if r["EV/S (TTM)"] is not none else "—" }}</td>
            <td>{{ "{:.2f}".format(r["EV/EBITDA (TTM)"]) if r["EV/EBITDA (TTM)"] is not none else "—" }}</td>
            <td>{{ "{:.2f}%".format(r["Dividend Yield %"]) if r["Dividend Yield %"] is not none else "—" }}</td>
            <td>{{ "{:.2f}%".format(r["FCF Yield %"]) if r["FCF Yield %"] is not none else "—" }}</td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
      <div class="muted" style="margin-top:8px">
        Subject 5-yr avgs: EV/S {{ "{:.2f}".format(peer_five_year["EV/S 5y Avg"]) if peer_five_year["EV/S 5y Avg"] is not none else "—" }},
        EV/EBITDA {{ "{:.2f}".format(peer_five_year["EV/EBITDA 5y Avg"]) if peer_five_year["EV/EBITDA 5y Avg"] is not none else "—" }}.
      </div>
    </div>
  </section>

  <footer class="section muted">
    <div>Data source: Financial Modeling Prep (FMP). Figures may differ from issuer disclosures due to vendor methodologies.</div>
  </footer>
</div>
</body>
</html>
